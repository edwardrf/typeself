import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;

import javax.imageio.ImageIO;


public class Converter {

	BufferedImage inputImage, outputImage;
	String outputFilename;
	int [][] target, canvas;
	int width, height;
	
	public Converter(String input, String output) throws IOException{
		inputImage = ImageIO.read(new File(input));
		outputFilename = output;
		this.width = inputImage.getWidth();
		this.height = inputImage.getHeight();
		
		target = new int[height][width];
		canvas = new int[height][width];
		for(int i = 0; i < height; i++){
			for(int j = 0; j < width; j++){
				int c = inputImage.getRGB(j, i);
				int a = c >> 24 & 0x0f;
				int r = c >> 16 & 0x0f;
				int g = c >> 8 & 0x0f;
				int b = c & 0x0f;
				target[i][j] = (int) ((0.2126 * r + 0.7152 * g + 0.0722 * b) * a / 255);
			}
		}
	}
	
	public void save() throws IOException {
		outputImage = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);
		for(int i = 0; i < height; i++){
			for(int j = 0; j < width; j++k){
				int c = target[j][i];
				if(c > 255) c = 255;
//				c = c + c << 8 + c << 16;
				outputImage.setRGB(j, i, 0xff0000);
			}
		}
		ImageIO.write(outputImage, "jpg", new File(outputFilename));
	}
	
	public static void main(String[] args) throws IOException {
		if(args.length < 2) {
			System.out.println("Usage: java Converter INPUT_IMG OUTPUT_IMG");
		}else {
			Converter c = new Converter(args[0], args[1]);
			c.save();
		}
	}

}
