import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;

import javax.imageio.ImageIO;


public class Converter {

	BufferedImage inputImage, outputImage;
	String outputFilename;
	int [][] target, canvas;
	int width, height;
	
	public Converter(String input, String output) throws IOException{
		inputImage = ImageIO.read(new File(input));
		outputFilename = output;
		this.width = inputImage.getWidth();
		this.height = inputImage.getHeight();
		
		target = new int[height][width];
		canvas = new int[height][width];
		for(int i = 0; i < height; i++){
			for(int j = 0; j < width; j++){
				int c = inputImage.getRGB(j, i);
				int a = c >> 24 & 0xff;
				int r = c >> 16 & 0xff;
				int g = c >> 8 & 0xff;
				int b = c & 0xff;
				target[i][j] = (int) ((0.2126 * r + 0.7152 * g + 0.0722 * b) * a / 255);
//				System.out.println("R " + r + "\tG " + g + "\tB " + b + "\tA " + a + "\tT " + target[i][j]);
			}
		}
	}
	
	public void save() throws IOException {
		outputImage = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);
		for(int i = 0; i < height; i++){
			for(int j = 0; j < width; j++){
				int c = target[j][i];
//				System.out.println(c);
				if(c > 255) c = 255;
				c = c + c << 8 + c << 16;
				outputImage.setRGB(j, i, c);
			}
		}
		ImageIO.write(outputImage, "jpg", new File(outputFilename));
	}
	
	public static void main(String[] args) throws IOException {
		if(args.length < 2) {
			System.out.println("Usage: java Converter INPUT_IMG OUTPUT_IMG");
		}else {
			Converter c = new Converter(args[0], args[1]);
			c.save();
		}
	}

}
